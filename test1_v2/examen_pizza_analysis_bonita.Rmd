---
title: "EXAMEN 1 - LABORATORIO Estadística General"
subtitle: "Análisis Estadístico Descriptivo - Pizza Delivery Dataset"
author: "yo"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Introducción

Este análisis examina los datos de entrega de pizza de un restaurante de pizzas durante mayo de 2014, enfocándose en estadística descriptiva y visualización de datos.

# Carga y preparación de datos

```{r}
# Cargar librerías necesarias
library(ggplot2)
library(dplyr)
library(gridExtra)

# Cargar los datos
datos <- read.csv("pizzadelivery.csv", header = FALSE, stringsAsFactors = FALSE)

# Asignar nombres de columnas
colnames(datos) <- c("id", "day", "date", "time", "operator", "branch", 
                     "driver", "temperature", "bill", "pizzas", 
                     "free_wine", "got_wine", "discount_customer")

# Convertir variables a tipos apropiados
datos$id <- as.numeric(datos$id)
datos$time <- as.numeric(datos$time)
datos$temperature <- as.numeric(datos$temperature)
datos$bill <- as.numeric(datos$bill)
datos$pizzas <- as.numeric(datos$pizzas)
datos$free_wine <- as.numeric(datos$free_wine)
datos$got_wine <- as.numeric(datos$got_wine)
datos$discount_customer <- as.numeric(datos$discount_customer)

# Convertir variables categóricas a factor
datos$day <- as.factor(datos$day)
datos$operator <- as.factor(datos$operator)
datos$branch <- as.factor(datos$branch)
datos$driver <- as.factor(datos$driver)

# Mostrar estructura de los datos
str(datos)
head(datos)
```

# Problema 1: Clasificación de Variables

## Análisis de Variables

```{r}
# Crear tabla de clasificación de variables
clasificacion <- data.frame(
  Variable = c("id", "day", "date", "time", "operator", "branch", "driver", 
               "temperature", "bill", "pizzas", "free_wine", "got_wine", "discount_customer"),
  Tipo = c("Cuantitativa", "Categórica", "Categórica", "Cuantitativa", 
           "Categórica", "Categórica", "Categórica", "Cuantitativa", 
           "Cuantitativa", "Cuantitativa", "Categórica", "Categórica", "Categórica"),
  Subtipo = c("Discreta", "Nominal", "Ordinal", "Continua", 
              "Nominal", "Nominal", "Nominal", "Continua", 
              "Continua", "Discreta", "Nominal", "Nominal", "Nominal"),
  Descripción = c("Identificador único", "Día de la semana", "Fecha del pedido", 
                  "Tiempo de entrega (min)", "Operador telefónico", "Sucursal del restaurant", 
                  "Repartidor", "Temperatura de entrega (°C)", "Cuenta total (euros)", 
                  "Número de pizzas", "Vino gratis (0/1)", "Llevó vino (0/1)", "Cliente con descuento (0/1)")
)

knitr::kable(clasificacion, caption = "Clasificación de Variables")
```

**Conclusión Problema 1:** 
Las variables se clasifican en 6 cuantitativas (4 continuas y 2 discretas) y 7 categóricas (6 nominales y 1 ordinal). La variable "date" se considera ordinal ya que tiene un orden temporal natural. Esta clasificación es fundamental para seleccionar los métodos estadísticos apropiados.

# Problema 2: Análisis de la Variable "day"

```{r}
# Análisis de frecuencias para day
freq_day <- table(datos$day)
prop_day <- prop.table(freq_day)

# Crear tabla de frecuencias
tabla_day <- data.frame(
  Dia = names(freq_day),
  Frecuencia_Absoluta = as.numeric(freq_day),
  Frecuencia_Relativa = round(as.numeric(prop_day), 4),
  Porcentaje = round(as.numeric(prop_day) * 100, 2)
)

knitr::kable(tabla_day, caption = "Tabla de Frecuencias - Variable Day")

# Ordenar días de la semana lógicamente
datos$day <- factor(datos$day, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", 
                                         "Friday", "Saturday", "Sunday"))

# Gráfico de barras
p1 <- ggplot(datos, aes(x = day)) +
  geom_bar(fill = "steelblue", alpha = 0.7) +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(title = "Distribución de Pedidos por Día de la Semana",
       x = "Día de la Semana",
       y = "Frecuencia Absoluta") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Gráfico circular
pie_data <- data.frame(table(datos$day))
colnames(pie_data) <- c("Dia", "Frecuencia")
pie_data$Porcentaje <- round((pie_data$Frecuencia / sum(pie_data$Frecuencia)) * 100, 1)

p2 <- ggplot(pie_data, aes(x = "", y = Frecuencia, fill = Dia)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  labs(title = "Distribución Porcentual por Día") +
  theme_void() +
  geom_text(aes(label = paste0(Porcentaje, "%")), 
            position = position_stack(vjust = 0.5))

grid.arrange(p1, p2, ncol = 2)
```

**Conclusión Problema 2:** 
El análisis de frecuencias muestra que `r names(which.max(table(datos$day)))` fue el día con mayor número de pedidos (`r max(table(datos$day))` pedidos, `r round(max(prop.table(table(datos$day)))*100, 1)`%), mientras que `r names(which.min(table(datos$day)))` tuvo el menor número (`r min(table(datos$day))` pedidos, `r round(min(prop.table(table(datos$day)))*100, 1)`%). Esto sugiere patrones de demanda diferenciados a lo largo de la semana, posiblemente relacionados con hábitos de consumo de los clientes.

# Problema 3: Histograma de Time

```{r}
# Estadísticas básicas de time
media_time <- mean(datos$time, na.rm = TRUE)
mediana_time <- median(datos$time, na.rm = TRUE)

# Histograma con intervalos de clase específicos
hist_time <- ggplot(datos, aes(x = time)) +
  geom_histogram(bins = 10, fill = "lightcoral", alpha = 0.7, color = "black") +
  geom_vline(xintercept = media_time, color = "red", linetype = "dashed", size = 1) +
  geom_text(aes(x = media_time, y = Inf, label = paste("Media =", round(media_time, 2))), 
            vjust = 2, hjust = -0.1, color = "red") +
  labs(title = "Histograma de Tiempo de Entrega",
       x = "Tiempo (minutos)",
       y = "Frecuencia Absoluta") +
  theme_minimal()

print(hist_time)

# Determinar el intervalo donde se encuentra la media
hist_data <- hist(datos$time, plot = FALSE, breaks = 10)
intervalos <- data.frame(
  Intervalo = paste0("[", round(hist_data$breaks[-length(hist_data$breaks)], 1), 
                     ", ", round(hist_data$breaks[-1], 1), ")"),
  Frecuencia = hist_data$counts
)

# Encontrar en qué intervalo está la media
intervalo_media <- which(media_time >= hist_data$breaks[-length(hist_data$breaks)] & 
                        media_time < hist_data$breaks[-1])

knitr::kable(intervalos, caption = "Intervalos de Clase - Tiempo de Entrega")

cat("La media aritmética del tiempo de entrega es:", round(media_time, 2), "minutos")
cat("\nSe encuentra en el intervalo:", intervalos$Intervalo[intervalo_media])
```

**Conclusión Problema 3:** 
La media aritmética del tiempo de entrega (`r round(media_time, 2)` minutos) se encuentra en el intervalo `r intervalos$Intervalo[intervalo_media]`, que corresponde a uno de los intervalos con mayor frecuencia en el histograma. Esto indica que la distribución de tiempos de entrega es relativamente simétrica alrededor de la media.

# Problema 4: Análisis Descriptivo de "temperature"

```{r}
# Estadísticas descriptivas completas para temperature
media_temp <- mean(datos$temperature, na.rm = TRUE)
mediana_temp <- median(datos$temperature, na.rm = TRUE)
desv_temp <- sd(datos$temperature, na.rm = TRUE)
coef_var_temp <- (desv_temp / media_temp) * 100

# Función para calcular la moda
calcular_moda <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
moda_temp <- calcular_moda(datos$temperature)

# Estadísticas adicionales
stats_temp <- data.frame(
  Estadística = c("Media", "Mediana", "Moda", "Desviación Estándar", "Coeficiente de Variación (%)",
                  "Mínimo", "Máximo", "Primer Cuartil (Q1)", "Tercer Cuartil (Q3)", "Rango",
                  "Percentil 10", "Percentil 90", "Varianza"),
  Valor = c(round(media_temp, 2), round(mediana_temp, 2), round(moda_temp, 2), 
            round(desv_temp, 2), round(coef_var_temp, 2), 
            round(min(datos$temperature, na.rm = TRUE), 2), 
            round(max(datos$temperature, na.rm = TRUE), 2),
            round(quantile(datos$temperature, 0.25, na.rm = TRUE), 2),
            round(quantile(datos$temperature, 0.75, na.rm = TRUE), 2),
            round(max(datos$temperature, na.rm = TRUE) - min(datos$temperature, na.rm = TRUE), 2),
            round(quantile(datos$temperature, 0.10, na.rm = TRUE), 2),
            round(quantile(datos$temperature, 0.90, na.rm = TRUE), 2),
            round(var(datos$temperature, na.rm = TRUE), 2))
)

knitr::kable(stats_temp, caption = "Estadísticas Descriptivas - Temperatura de Entrega")

# Análisis de demanda por día
demanda_dia <- table(datos$day)
dia_mayor_demanda <- names(which.max(demanda_dia))

cat("Día con mayor demanda:", dia_mayor_demanda, "con", max(demanda_dia), "pedidos")

# Visualizaciones
p1_temp <- ggplot(datos, aes(x = temperature)) +
  geom_histogram(bins = 15, fill = "lightblue", alpha = 0.7, color = "black") +
  geom_vline(xintercept = media_temp, color = "red", linetype = "dashed") +
  geom_vline(xintercept = mediana_temp, color = "blue", linetype = "dashed") +
  geom_vline(xintercept = moda_temp, color = "green", linetype = "dashed") +
  labs(title = "Histograma - Temperatura de Entrega",
       subtitle = "Líneas: Media (roja), Mediana (azul), Moda (verde)",
       x = "Temperatura (°C)",
       y = "Frecuencia") +
  theme_minimal()

p2_temp <- ggplot(datos, aes(y = temperature)) +
  geom_boxplot(fill = "lightgreen", alpha = 0.7) +
  labs(title = "Boxplot - Temperatura de Entrega",
       y = "Temperatura (°C)") +
  theme_minimal()

# Polígono de frecuencias
hist_data_temp <- hist(datos$temperature, plot = FALSE, breaks = 15)
polygon_data <- data.frame(
  x = hist_data_temp$mids,
  y = hist_data_temp$counts
)

p3_temp <- ggplot(polygon_data, aes(x = x, y = y)) +
  geom_line(color = "red", size = 1) +
  geom_point(color = "red", size = 2) +
  labs(title = "Polígono de Frecuencias - Temperatura",
       x = "Temperatura (°C)",
       y = "Frecuencia") +
  theme_minimal()

grid.arrange(p1_temp, p2_temp, p3_temp, ncol = 2, nrow = 2)
```

**Conclusión Problema 4:** 
El análisis descriptivo de la temperatura muestra:

- **Tendencia Central**: Media = `r round(media_temp, 2)`°C, Mediana = `r round(mediana_temp, 2)`°C, Moda = `r round(moda_temp, 2)`°C
- **Variabilidad**: Coeficiente de variación = `r round(coef_var_temp, 2)`%, indicando variabilidad `r ifelse(coef_var_temp < 20, "baja", ifelse(coef_var_temp < 30, "moderada", "alta"))`
- **Distribución**: La proximidad entre media, mediana y moda sugiere una distribución aproximadamente simétrica

**Día con mayor demanda**: `r dia_mayor_demanda` con `r max(demanda_dia)` pedidos, representando el `r round(max(demanda_dia)/sum(demanda_dia)*100, 1)`% del total de pedidos del mes.

# Problema 5: Análisis de Temperatura por Día

```{r}
# Análisis de temperatura por día
temp_por_dia <- datos %>%
  group_by(day) %>%
  summarise(
    Pedidos = n(),
    Temp_Promedio = round(mean(temperature, na.rm = TRUE), 2),
    Temp_Mediana = round(median(temperature, na.rm = TRUE), 2),
    Desv_Estandar = round(sd(temperature, na.rm = TRUE), 2),
    Coef_Variacion = round((sd(temperature, na.rm = TRUE) / mean(temperature, na.rm = TRUE)) * 100, 2),
    Temp_Min = round(min(temperature, na.rm = TRUE), 2),
    Temp_Max = round(max(temperature, na.rm = TRUE), 2),
    Rango = round(max(temperature, na.rm = TRUE) - min(temperature, na.rm = TRUE), 2)
  ) %>%
  arrange(desc(Temp_Promedio))

knitr::kable(temp_por_dia, caption = "Análisis de Temperatura por Día de la Semana")

# Identificar día con mayor temperatura
dia_mayor_temp <- temp_por_dia$day[1]
temp_mayor <- temp_por_dia$Temp_Promedio[1]

cat("Día con mayor temperatura promedio:", dia_mayor_temp, "con", temp_mayor, "°C")

# Boxplot comparativo por día
boxplot_temp_dia <- ggplot(datos, aes(x = day, y = temperature, fill = day)) +
  geom_boxplot(alpha = 0.7) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "red") +
  labs(title = "Distribución de Temperatura por Día de la Semana",
       x = "Día de la Semana",
       y = "Temperatura (°C)",
       caption = "Rombos rojos indican la media por día") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))

print(boxplot_temp_dia)

# Gráfico de barras para temperatura promedio
bar_temp_dia <- ggplot(temp_por_dia, aes(x = reorder(day, Temp_Promedio), 
                                         y = Temp_Promedio, fill = day)) +
  geom_bar(stat = "identity", alpha = 0.7) +
  geom_text(aes(label = Temp_Promedio), hjust = -0.1) +
  labs(title = "Temperatura Promedio por Día de la Semana",
       x = "Día de la Semana",
       y = "Temperatura Promedio (°C)") +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip()

print(bar_temp_dia)

# Tabla de frecuencias de temperatura por rangos para cada día
datos$rango_temp <- cut(datos$temperature, 
                       breaks = c(50, 55, 60, 65, 70), 
                       labels = c("50-55°C", "55-60°C", "60-65°C", "65-70°C"),
                       include.lowest = TRUE)

freq_temp_dia <- table(datos$day, datos$rango_temp)
knitr::kable(freq_temp_dia, caption = "Frecuencias de Temperatura por Rangos y Día")
```

**Conclusión Problema 5:** 

Basándose en el análisis de temperatura por día de entrega:

**Día con mayor temperatura**: `r dia_mayor_temp` registró la temperatura promedio más alta (`r temp_mayor`°C) durante mayo de 2014.

**Análisis detallado:**
- **Variabilidad**: El coeficiente de variación muestra que `r temp_por_dia$day[which.min(temp_por_dia$Coef_Variacion)]` tiene la menor variabilidad (`r min(temp_por_dia$Coef_Variacion, na.rm = TRUE)`%), indicando mayor consistencia en las temperaturas
- **Rango**: `r temp_por_dia$day[which.max(temp_por_dia$Rango)]` presenta el mayor rango de temperaturas (`r max(temp_por_dia$Rango, na.rm = TRUE)`°C), sugiriendo mayor variabilidad
- **Distribución**: Los boxplots revelan que algunos días tienen distribuciones más simétricas que otros, con presencia de valores atípicos en ciertos días

Este patrón puede estar relacionado con factores operativos específicos del día de la semana, como volumen de pedidos, disponibilidad de personal o procesos de cocina.

# Resumen General

Este análisis descriptivo revela patrones importantes en el servicio de entrega:

1. **Variables**: Correctamente clasificadas entre categóricas y cuantitativas
2. **Demanda**: `r dia_mayor_demanda` fue el día de mayor demanda con `r max(demanda_dia)` pedidos
3. **Tiempos**: Distribución simétrica con media de `r round(media_time, 2)` minutos
4. **Temperaturas**: Media de `r round(media_temp, 2)`°C con variabilidad `r ifelse(coef_var_temp < 20, "baja", "moderada")`
5. **Temperatura por día**: `r dia_mayor_temp` registró las temperaturas más altas

Estas conclusiones pueden guiar decisiones operativas para mejorar el control de calidad y la eficiencia del servicio de entrega.